<!DOCTYPE html>
<html>
<head>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.15.1/dist/phaser-arcade-physics.min.js"></script>
</head>
<body>

    <script>
    var config = {
        type: Phaser.AUTO,
        width: 800,
        height: 600,
        physics: {
            default: 'arcade',
            arcade: {
                //gravity: { y: 300 }
            }
        },
        scene: {
            preload: preload,
            create: create,
            update: update
        }
    };

    var game = new Phaser.Game(config);

    function preload ()
    {
        this.load.image('sky', '/assets/images/space2.png');
        this.load.image('truck', '/assets/images/alienbusters.png');
        this.load.image('asteroid', '/assets/images/red_ball.png');

        //this.load.image('red', 'assets/particles/red.png');
        //load asteroid images
    }

    let cursors;
    let player;
    let asteroids;
    let gameOver = false;

    function create ()
    {
        this.add.image(400, 300, 'sky');

        player = this.physics.add.sprite(400, 100, 'truck');
        //player.setOrigin(200, 300);
        player.setBounce(0.2);
        player.setCollideWorldBounds(true);

        cursors = this.input.keyboard.createCursorKeys();

        //asteroids = this.physics.add.group();
        //asteroids.create(200, 200, 'truck');
        asteroids = this.physics.add.group({ 
            key: 'asteroid', 
            repeat: 11, 
            setXY: { x: 0, y: Phaser.Math.Between(0, 600)},
            stepY: 70 
        })
        for (let i =0; i < 11; i++) {
            setTimeout(() => {
                let instance = asteroids.create(Phaser.Math.Between(0, 600), Phaser.Math.Between(0, 800), 'asteroid');
                instance.setVelocityY(Phaser.Math.Between(100, 400));
                instance.setVelocityX(Phaser.Math.Between(100, 400));
            }, 3000)
        }

        function hitAsteroid (player, asteroid) {
            this.physics.pause();
            gameOver = true;
        }

        this.physics.add.collider(player, asteroids, hitAsteroid, null, this);
        
    }
    function update() {
        if(!gameOver) {
            if (cursors.up.isDown) {
                player.y -= 10;
            }
            else if (cursors.down.isDown) {
                player.y += 10;
            }
            else if (cursors.left.isDown) {
                player.x -= 10;
            }
            else if (cursors.right.isDown) {
                player.x += 10;
            }
        }
    }
    </script>

</body>
</html>